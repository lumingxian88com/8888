<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 戰略終端 V10.0</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: monospace; overflow: hidden; display: flex; }
        #canvas-wrap { flex: 1; height: 100vh; position: relative; }
        canvas { display: block; }
        .panel { width: 220px; background: #080808; border-left: 3px solid #f00; display: flex; flex-direction: column; gap: 6px; padding: 8px; box-sizing: border-box; }
        
        #reset-btn { width: 100%; height: 60px; background: #400; border: 2px solid #f00; border-radius: 10px; color: #ff4444; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 4px; }
        #reset-btn.active { background: #f00; color: #fff; box-shadow: 0 0 15px #f00; }

        .group { background: #111; border: 1px solid #333; padding: 6px; border-radius: 10px; text-align: center; }
        .label { font-size: 11px; color: #666; margin-bottom: 2px; text-transform: uppercase; }
        .val { font-size: 30px; color: #0f0; font-weight: 900; margin-bottom: 4px; text-shadow: 0 0 10px rgba(0,255,0,0.3); }
        
        .btn-row { display: flex; gap: 4px; }
        .btn-row button { flex: 1; padding: 12px 0; background: #222; color: #fff; border: 1px solid #444; border-radius: 6px; cursor: pointer; font-size: 20px; font-weight: bold; }
        .btn-row button:active { background: #f00; border-color: #fff; }

        /* 下方號碼追蹤區 - 藍色調 */
        .obs { border-color: #004488; background: #000815; }
        .obs .val { color: #00dfff; text-shadow: 0 0 10px rgba(0,223,255,0.3); }
    </style>
</head>
<body>

<div id="canvas-wrap"><canvas id="main"></canvas></div>

<div class="panel">
    <button id="reset-btn" onclick="toggleReturn()">開始 / 回歸 (12/31)</button>

    <div class="group">
        <div class="label">Analysis Days</div>
        <div id="d-v" class="val">06</div>
        <div class="btn-row"><button onclick="chgD(-1)">▼</button><button onclick="chgD(1)">▲</button></div>
    </div>

    <div class="group">
        <div class="label">Date Orbit</div>
        <div id="r-v" class="val">00</div>
        <div class="btn-row"><button onclick="chgR(-1)">▼</button><button onclick="chgR(1)">▲</button></div>
    </div>

    <div class="group">
        <div class="label">Scan Target</div>
        <div id="c-v" class="val">01</div>
        <div class="btn-row"><button onclick="chgC(-1)">▼</button><button onclick="chgC(1)">▲</button></div>
    </div>

    <div style="height: 2px; background: #333; margin: 5px 0;"></div>

    <div class="group obs">
        <div class="label">Track A</div>
        <div id="o1-v" class="val">10</div>
        <div class="btn-row"><button onclick="chgO(1,-1)">▼</button><button onclick="chgO(1,1)">▲</button></div>
    </div>

    <div class="group obs">
        <div class="label">Track B</div>
        <div id="o2-v" class="val">22</div>
        <div class="btn-row"><button onclick="chgO(2,-1)">▼</button><button onclick="chgO(2,1)">▲</button></div>
    </div>

    <div class="group obs">
        <div class="label">Track C</div>
        <div id="o3-v" class="val">07</div>
        <div class="btn-row"><button onclick="chgO(3,-1)">▼</button><button onclick="chgO(3,1)">▲</button></div>
    </div>
</div>

<script>
const F = [31,37,37,48,41,40,56,44,41,37,42,46,37,49,32,30,27,37,41,36,39,43,39,52,36,47,53,46,42,35,44,34,34,34,39,38,36,46,39];
const D = [[1,15,19,28,38],[1,10,20,27,36],[14,18,28,36,39],[2,3,14,25,30],[9,22,24,30,35],[2,22,24,27,38],[1,5,16,35,38],[12,16,23,27,30],[4,9,32,33,36],[5,6,7,19,32],[2,10,14,33,35],[3,17,27,29,38],[2,9,21,31,38],[10,24,26,28,35],[2,6,17,25,26],[4,7,11,16,26],[7,8,15,30,39],[5,23,27,28,31],[6,22,23,24,32],[2,3,16,17,29],[1,7,20,25,37],[5,9,14,33,35],[2,5,8,13,29],[2,3,4,20,24],[8,27,30,33,36],[8,13,14,22,28],[7,19,22,25,28],[8,6,12,22,34],[9,30,36,38,39],[2,4,5,17,31],[10,13,32,33,37],[5,10,17,28,35],[1,5,33,36,38],[3,11,20,28,31],[14,24,31,36,37],[4,7,16,16,29],[12,20,25,28,29],[2,11,15,37,38],[13,18,20,23,36],[1,4,9,14,22],[5,19,31,34,39],[7,14,15,17,30],[7,8,9,26,34],[22,27,30,32,37],[7,24,28,31,32],[11,14,15,27,39],[1,7,12,29,39],[24,25,34,36,37],[8,12,19,27,28],[11,18,25,26,33],[5,27,28,31,37],[26,32,33,36,39],[18,20,25,29,31],[3,20,26,31,37],[3,4,11,21,34],[8,11,13,37,38],[18,15,27,37,38],[3,4,20,25,28],[13,22,30,37,38],[6,13,22,23,27],[2,17,32,35,38]];
const dates = (()=>{let d=[],c=new Date("2026-01-01");while(d.length<100){if(c.getDay()!==0)d.push(`${(c.getMonth()+1)}/${c.getDate()}`);c.setDate(c.getDate()-1);}return d;})();

const cvs = document.getElementById('main'), ctx = cvs.getContext('2d');
let mul = 1, sR = 0, sC = 0, obs = [10, 22, 7], blk = true, isRunning = false;

function render() {
    cvs.width = window.innerWidth - 220; cvs.height = window.innerHeight;
    const sD = mul * 6, p = {l: 85, r: 35, t: 15, b: 85}, W = cvs.width - p.l - p.r, H = cvs.height - p.t - p.b, cw = W / 39, rh = H / 60;
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width,cvs.height);
    ctx.fillStyle = '#f00'; ctx.font = 'bold 24px Arial'; ctx.textAlign = 'right';
    ctx.fillText("60", p.l-15, p.t+22); ctx.fillText("20", p.l-15, p.t+59*rh+5);
    for(let i=0; i<39; i++) {
        let x=p.l+i*cw, v=F[i]||0, bh=((Math.max(20,Math.min(v,60))-20)/40)*(59*rh);
        if(i===sC&&blk){ctx.fillStyle='rgba(0,255,0,0.1)';ctx.fillRect(x,p.t,cw,H);}
        ctx.fillStyle=(i===sC&&blk)?'#0ff':'rgba(0,100,255,0.4)';
        ctx.fillRect(x+2,p.t+59*rh-bh,cw-4,bh);
        ctx.fillStyle=(i===sC)?'#0f0':'#888';ctx.font='bold 16px Arial';ctx.textAlign='center';
        ctx.fillText((i+1).toString().padStart(2,'0'),x+cw/2,p.t+59*rh+40);
    }
    for(let r=0;r<60;r++) {
        let y=p.t+r*rh+rh/2, show=r<sD;
        ctx.strokeStyle=(r===sR&&blk)?'#f00':(show?'#222':'#0a0a0a');
        ctx.lineWidth=(r===sR&&blk)?3:1; ctx.beginPath();ctx.moveTo(p.l,y);ctx.lineTo(p.l+W,y);ctx.stroke();
        if(show){ctx.fillStyle=(r===sR&&blk)?'#f00':'#555';ctx.font='12px Arial';ctx.textAlign='right';ctx.fillText(dates[r]||"",p.l-15,y+5);}
        if(show&&D[r]) D[r].forEach(n=>{
            let x=p.l+(n-1)*cw+cw/2, isT=(n-1===sC||obs.includes(n))&&blk;
            ctx.fillStyle=(r===sR&&n-1===sC&&blk)?'#fff':(obs.includes(n)?'#00dfff':(isT?'#f00':'#400000'));
            ctx.beginPath();ctx.arc(x,y,Math.min(cw,rh)/2.3,0,Math.PI*2);ctx.fill();
            ctx.fillStyle=(r===sR&&n-1===sC&&blk||obs.includes(n))?'#000':'#fff';
            ctx.font='bold 11px Arial';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(n.toString().padStart(2,'0'),x,y);
        });
    }
}
function toggleReturn() {
    const b=document.getElementById('reset-btn');
    if(!isRunning){isRunning=true;b.innerText="回歸 12/31";b.classList.add('active');}
    else{isRunning=false;b.innerText="開始分析";b.classList.remove('active');mul=1;sR=0;sC=0;sync();}
}
function chgD(v){mul=Math.max(1,Math.min(10,mul+v));sync();}
function chgR(v){let m=mul*6;sR=(sR+v+m)%m;sync();}
function chgC(v){sC=(sC+v+39)%39;sync();}
function chgO(idx,v){obs[idx-1]=(obs[idx-1]+v+39)%40;if(obs[idx-1]===0)obs[idx-1]=39;sync();}
function sync(){
    document.getElementById('d-v').innerText=(mul*6).toString().padStart(2,'0');
    document.getElementById('r-v').innerText=sR.toString().padStart(2,'0');
    document.getElementById('c-v').innerText=(sC+1).toString().padStart(2,'0');
    document.getElementById('o1-v').innerText=obs[0].toString().padStart(2,'0');
    document.getElementById('o2-v').innerText=obs[1].toString().padStart(2,'0');
    document.getElementById('o3-v').innerText=obs[2].toString().padStart(2,'0');
    render();
}
setInterval(()=>{blk=!blk;render();},400); window.onresize=render; sync();
</script>
</body>
</html>
