<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 戰略終端 - 座標對位版</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: monospace; overflow: hidden; display: flex; }
        #canvas-wrap { flex: 1; height: 100vh; position: relative; }
        canvas { display: block; }
        .panel { width: 230px; background: #080808; border-left: 3px solid #f00; display: flex; flex-direction: column; gap: 4px; padding: 6px; box-sizing: border-box; overflow-y: auto; }
        #reset-btn { width: 100%; height: 50px; background: #400; border: 2px solid #f00; border-radius: 10px; color: #ff4444; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 5px; }
        #reset-btn.active { background: #f00; color: #fff; box-shadow: 0 0 20px #f00; }
        .group { background: #111; border: 1px solid #333; padding: 6px; border-radius: 10px; text-align: center; }
        .label { font-size: 10px; color: #666; margin-bottom: 2px; }
        .val { font-size: 26px; color: #0f0; font-weight: 900; }
        .btn-row { display: flex; gap: 4px; margin-top: 4px; }
        .btn-row button { flex: 1; padding: 10px 0; background: #222; color: #fff; border: 1px solid #444; border-radius: 6px; cursor: pointer; font-size: 20px; font-weight: bold; }
        .obs { border-color: #004488; background: #000815; }
        .obs .val { color: #00dfff; }
    </style>
</head>
<body>
<div id="canvas-wrap"><canvas id="main"></canvas></div>
<div class="panel">
    <button id="reset-btn" onclick="toggleReturn()">開始 / 回歸 (12/31)</button>
    <div class="group"><div class="label">RANGE</div><div id="d-v" class="val">06</div><div class="btn-row"><button onclick="chgD(-6)">▼</button><button onclick="chgD(6)">▲</button></div></div>
    <div class="group"><div class="label">ORBIT</div><div id="r-v" class="val">00</div><div class="btn-row"><button onclick="chgR(-1)">▼</button><button onclick="chgR(1)">▲</button></div></div>
    <div class="group"><div class="label">SCAN</div><div id="c-v" class="val">01</div><div class="btn-row"><button onclick="chgC(-1)">▼</button><button onclick="chgC(1)">▲</button></div></div>
    <div style="height: 1px; background: #444; margin: 4px 0;"></div>
    <div class="group obs"><div class="label">TRK A</div><div id="o1-v" class="val">10</div><div class="btn-row"><button onclick="chgO(1,-1)">▼</button><button onclick="chgO(1,1)">▲</button></div></div>
    <div class="group obs"><div class="label">TRK B</div><div id="o2-v" class="val">22</div><div class="btn-row"><button onclick="chgO(2,-1)">▼</button><button onclick="chgO(2,1)">▲</button></div></div>
    <div class="group obs"><div class="label">TRK C</div><div id="o3-v" class="val">07</div><div class="btn-row"><button onclick="chgO(3,-1)">▼</button><button onclick="chgO(3,1)">▲</button></div></div>
    <div class="group obs"><div class="label">TRK D</div><div id="o4-v" class="val">01</div><div class="btn-row"><button onclick="chgO(4,-1)">▼</button><button onclick="chgO(4,1)">▲</button></div></div>
    <div class="group obs"><div class="label">TRK E</div><div id="o5-v" class="val">02</div><div class="btn-row"><button onclick="chgO(5,-1)">▼</button><button onclick="chgO(5,1)">▲</button></div></div>
    <div class="group obs"><div class="label">TRK F</div><div id="o6-v" class="val">03</div><div class="btn-row"><button onclick="chgO(6,-1)">▼</button><button onclick="chgO(6,1)">▲</button></div></div>
</div>
<script>
const D = Array.from({length: 61}, () => Array.from({length: 5}, () => Math.floor(Math.random() * 39) + 1));
const dates = (()=>{let d=[],c=new Date("2026-01-01");while(d.length<100){if(c.getDay()!==0)d.push(`${(c.getMonth()+1)}/${c.getDate()}`);c.setDate(c.getDate()-1);}return d;})();
const cvs = document.getElementById('main'), ctx = cvs.getContext('2d');
let mulD = 6, sR = 0, sC = 0, obs = [10, 22, 7, 1, 2, 3], blk = true, isRunning = false;

function render() {
    cvs.width = window.innerWidth - 230; cvs.height = window.innerHeight;
    const p = {l: 110, r: 35, t: 40, b: 85}, W = cvs.width - p.l - p.r, H = cvs.height - p.t - p.b;
    const cw = W / 39, rh = H / 59; // 59個間隔對應60天
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width,cvs.height);

    const xPos = p.l - 20;

    // 繪製座標
    for(let r=0; r<60; r++) {
        let y = p.t + r * rh;
        let dayNum = r + 1;
        let isStep = (dayNum % 6 === 0 || dayNum === 1 || dayNum === 60);
        
        ctx.strokeStyle = (dayNum === 1 || dayNum === 60) ? '#f00' : (isStep ? '#444' : '#111');
        ctx.beginPath(); ctx.moveTo(p.l, y); ctx.lineTo(p.l+W, y); ctx.stroke();

        if(isStep) {
            ctx.textAlign = 'right';
            // 第一天對齊 60
            if(dayNum === 1) {
                ctx.fillStyle = '#fff'; ctx.font = 'bold 20px Arial';
                ctx.fillText("60", xPos, y + 8);
                ctx.fillStyle = '#f00'; ctx.font = '12px Arial';
                ctx.fillText("1", xPos - 35, y + 6);
            } 
            // 最後一天對齊 20
            else if(dayNum === 60) {
                ctx.fillStyle = '#fff'; ctx.font = 'bold 20px Arial';
                ctx.fillText("20", xPos, y + 8);
                ctx.fillStyle = '#f00'; ctx.font = '12px Arial';
                ctx.fillText("60", xPos - 35, y + 6);
            }
            // 中間倍數標記
            else {
                ctx.fillStyle = '#666'; ctx.font = 'bold 14px Arial';
                ctx.fillText(dayNum.toString(), xPos - 35, y + 5);
            }
        }

        if(r < mulD) {
            ctx.fillStyle = '#444'; ctx.font = '10px Arial'; ctx.textAlign = 'right';
            ctx.fillText(dates[r]||"", p.l-70, y+4);
            if(D[r]) D[r].forEach(n => {
                let x=p.l+(n-1)*cw+cw/2, act=(r===sR&&n-1===sC&&blk);
                ctx.fillStyle=act?'#fff':(obs.includes(n)?'#00dfff':(n-1===sC&&blk?'#f00':'#300'));
                ctx.beginPath(); ctx.arc(x,y,Math.min(cw,rh)/2.5,0,Math.PI*2); ctx.fill();
            });
        }
    }
}
function chgD(v){ mulD+=v; if(mulD>60)mulD=6; if(mulD<6)mulD=60; sync(); }
function chgR(v){ sR=(sR+v+60)%60; sync(); }
function chgC(v){ sC=(sC+v+39)%39; sync(); }
function chgO(idx,v){ obs[idx-1]=(obs[idx-1]+v+39)%40; if(obs[idx-1]===0)obs[idx-1]=39; sync(); }
function toggleReturn() {
    if(!isRunning){isRunning=true; document.getElementById('reset-btn').classList.add('active');}
    else{isRunning=false; document.getElementById('reset-btn').classList.remove('active'); mulD=6; sR=0; sC=0; sync();}
}
function sync() {
    document.getElementById('d-v').innerText=mulD.toString().padStart(2,'0');
    document.getElementById('r-v').innerText=sR.toString().padStart(2,'0');
    document.getElementById('c-v').innerText=(sC+1).toString().padStart(2,'0');
    for(let i=1;i<=6;i++) document.getElementById(`o${i}-v`).innerText=obs[i-1].toString().padStart(2,'0');
    render();
}
setInterval(()=>{blk=!blk; render();}, 400); window.onresize=render; sync();
</script>
</body>
</html>
