<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 精密校準器 V7.0</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; display: flex; }
        #chart-container { flex: 1; height: 100vh; position: relative; }
        canvas { display: block; }
        .panel { 
            width: 160px; background: #0d0d0d; border-left: 2px solid #f00; 
            display: flex; flex-direction: column; gap: 15px; padding: 15px; box-sizing: border-box; 
        }
        .group { background: #1a1a1a; border: 1px solid #333; padding: 10px; border-radius: 12px; text-align: center; }
        .val { font-size: 30px; color: #0f0; font-weight: 900; font-family: monospace; }
        button { width: 100%; padding: 12px; margin: 4px 0; background: #333; color: #fff; border: 1px solid #f00; border-radius: 8px; cursor: pointer; font-size: 20px; font-weight: bold; }
        button:active { background: #f00; }
    </style>
</head>
<body>

<div id="chart-container"><canvas id="main"></canvas></div>

<div class="panel">
    <div class="group">
        <div style="font-size:12px;color:#888">天數</div>
        <div id="d-v" class="val">06</div>
        <button onclick="changeD(1)">▲</button>
        <button onclick="changeD(-1)">▼</button>
    </div>
    <div class="group">
        <div style="font-size:12px;color:#888">日期軌</div>
        <div id="r-v" class="val">00</div>
        <button onclick="changeR(1)">▲</button>
        <button onclick="changeR(-1)">▼</button>
    </div>
    <div class="group">
        <div style="font-size:12px;color:#888">號碼軌</div>
        <div id="c-v" class="val">01</div>
        <button onclick="changeC(1)">▲</button>
        <button onclick="changeC(-1)">▼</button>
    </div>
</div>

<script>
const F = [31,37,37,48,41,40,56,44,41,37,42,46,37,49,32,30,27,37,41,36,39,43,39,52,36,47,53,46,42,35,44,34,34,34,39,38,36,46,39];
const D = [[1,15,19,28,38],[1,10,20,27,36],[14,18,28,36,39],[2,3,14,25,30],[9,22,24,30,35],[2,22,24,27,38],[1,5,16,35,38],[12,16,23,27,30],[4,9,32,33,36],[5,6,7,19,32],[2,10,14,33,35],[3,17,27,29,38],[2,9,21,31,38],[10,24,26,28,35],[2,6,17,25,26],[4,7,11,16,26],[7,8,15,30,39],[5,23,27,28,31],[6,22,23,24,32],[2,3,16,17,29],[1,7,20,25,37],[5,9,14,33,35],[2,5,8,13,29],[2,3,4,20,24],[8,27,30,33,36],[8,13,14,22,28],[7,19,22,25,28],[8,6,12,22,34],[9,30,36,38,39],[2,4,5,17,31],[10,13,32,33,37],[5,10,17,28,35],[1,5,33,36,38],[3,11,20,28,31],[14,24,31,36,37],[4,7,16,16,29],[12,20,25,28,29],[2,11,15,37,38],[13,18,20,23,36],[1,4,9,14,22],[5,19,31,34,39],[7,14,15,17,30],[7,8,9,26,34],[22,27,30,32,37],[7,24,28,31,32],[11,14,15,27,39],[1,7,12,29,39],[24,25,34,36,37],[8,12,19,27,28],[11,18,25,26,33],[5,27,28,31,37],[26,32,33,36,39],[18,20,25,29,31],[3,20,26,31,37],[3,4,11,21,34],[8,11,13,37,38],[18,15,27,37,38],[3,4,20,25,28],[13,22,30,37,38],[6,13,22,23,27],[2,17,32,35,38]];
const cvs = document.getElementById('main'), ctx = cvs.getContext('2d');
let dMul = 1, selR = 0, selC = 0, blink = true;

function render() {
    cvs.width = window.innerWidth - 160; cvs.height = window.innerHeight;
    const showDays = dMul * 6, pad = {l: 80, r: 30, t: 15, b: 80};
    const W = cvs.width - pad.l - pad.r, H = cvs.height - pad.t - pad.b;
    const cw = W / 39, rh = H / 60; // 統一使用 60 分率確保對齊 60/20

    ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width,cvs.height);

    // 刻度 60 / 20 絕對鎖定在第 1 條線與第 60 條線
    ctx.fillStyle = '#f00'; ctx.font = 'bold 24px Arial'; ctx.textAlign = 'right';
    ctx.fillText("60", pad.l - 10, pad.t + 20);
    ctx.fillText("20", pad.l - 10, pad.t + 59 * rh + 5);

    // 藍色分析條
    for(let i=0; i<39; i++) {
        const x = pad.l + i * cw;
        let v = F[i] || 0, barH = ((Math.max(20, Math.min(v, 60)) - 20) / 40) * (59 * rh);
        if (i === selC && blink) { ctx.fillStyle = 'rgba(0,255,0,0.1)'; ctx.fillRect(x, pad.t, cw, H); }
        ctx.fillStyle = (i === selC && blink) ? '#0ff' : 'rgba(0,100,255,0.4)';
        ctx.fillRect(x + 2, pad.t + 59 * rh - barH, cw - 4, barH);
        ctx.fillStyle = (i === selC) ? '#0f0' : '#888'; ctx.font = 'bold 16px Arial'; ctx.textAlign = 'center';
        ctx.fillText((i+1).toString().padStart(2,'0'), x + cw/2, pad.t + 59 * rh + 35);
    }

    // 60 條精密橫線與數據紅點
    for(let r=0; r<60; r++) {
        const y = pad.t + r * rh + rh/2;
        const inShow = r < showDays;
        ctx.strokeStyle = (r === selR && blink) ? '#f00' : (inShow ? '#222' : '#0a0a0a');
        ctx.lineWidth = (r === selR && blink) ? 3 : 1;
        ctx.beginPath(); ctx.moveTo(pad.l, y); ctx.lineTo(pad.l + W, y); ctx.stroke();

        if (inShow && D[r]) {
            D[r].forEach(n => {
                const x = pad.l + (n-1) * cw + cw/2;
                const isH = (r === selR || n-1 === selC) && blink;
                ctx.fillStyle = (r === selR && n-1 === selC && blink) ? '#fff' : (isH ? '#f00' : '#400000');
                ctx.beginPath(); ctx.arc(x, y, Math.min(cw, rh) / 2.2, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = (r === selR && n-1 === selC && blink) ? '#000' : '#fff';
                ctx.font = 'bold 10px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(n.toString().padStart(2,'0'), x, y);
            });
        }
    }
    // 縱向綠線
    if(blink) {
        ctx.strokeStyle = '#0f0'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.moveTo(pad.l + selC * cw + cw/2, pad.t); ctx.lineTo(pad.l + selC * cw + cw/2, pad.t + 59 * rh + rh/2); ctx.stroke();
    }
}

function changeD(v) { dMul = Math.max(1, Math.min(10, dMul + v)); sync(); }
function changeR(v) { const m = dMul * 6; selR = (selR + v + m) % m; sync(); }
function changeC(v) { selC = (selC + v + 39) % 39; sync(); }
function sync() {
    document.getElementById('d-v').innerText = (dMul * 6).toString().padStart(2,'0');
    document.getElementById('r-v').innerText = selR.toString().padStart(2,'0');
    document.getElementById('c-v').innerText = (selC + 1).toString().padStart(2,'0');
    render();
}

setInterval(() => { blink = !blink; render(); }, 400);
window.onresize = render;
sync();
</script>
</body>
</html>
